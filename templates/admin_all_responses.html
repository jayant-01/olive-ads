{% extends "base.html" %}

{% block title %}All Responses{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4"><i class="fas fa-chart-line"></i> All Survey Responses (Admin)</h2>
    <p>This page will display a comprehensive list of all survey responses with detailed tracking data.</p>

    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-filter"></i> Filter Responses</h5>
        </div>
        <div class="card-body">
            <form method="GET" action="{{ url_for('admin_all_responses') }}">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label for="response_id_filter" class="form-label">Response ID</label>
                        <input type="text" class="form-control" id="response_id_filter" name="response_id" value="{{ request.args.get('response_id', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="survey_title_filter" class="form-label">Survey Title</label>
                        <input type="text" class="form-control" id="survey_title_filter" name="survey_title" value="{{ request.args.get('survey_title', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="start_date_filter" class="form-label">Start Date</label>
                        <input type="date" class="form-control" id="start_date_filter" name="start_date" value="{{ request.args.get('start_date', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="end_date_filter" class="form-label">End Date</label>
                        <input type="date" class="form-control" id="end_date_filter" name="end_date" value="{{ request.args.get('end_date', '') }}">
                    </div>

                    <div class="col-md-3">
                        <label for="respondent_id_filter" class="form-label">Respondent ID</label>
                        <input type="text" class="form-control" id="respondent_id_filter" name="respondent_id" value="{{ request.args.get('respondent_id', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="session_id_filter" class="form-label">Session ID</label>
                        <input type="text" class="form-control" id="session_id_filter" name="session_id" value="{{ request.args.get('session_id', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="form_status_filter" class="form-label">Form Status</label>
                        <select class="form-select" id="form_status_filter" name="form_status">
                            <option value="">All</option>
                            <option value="Complete" {% if request.args.get('form_status') == 'Complete' %}selected{% endif %}>Complete</option>
                            <option value="Pending" {% if request.args.get('form_status') == 'Pending' %}selected{% endif %}>Pending</option>
                            {# Add more statuses as needed #}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="browser_filter" class="form-label">Browser</label>
                        <input type="text" class="form-control" id="browser_filter" name="browser" value="{{ request.args.get('browser', '') }}">
                    </div>

                    <div class="col-md-3">
                        <label for="device_type_filter" class="form-label">Device Type</label>
                        <select class="form-select" id="device_type_filter" name="device_type">
                            <option value="">All</option>
                            <option value="Desktop" {% if request.args.get('device_type') == 'Desktop' %}selected{% endif %}>Desktop</option>
                            <option value="Mobile" {% if request.args.get('device_type') == 'Mobile' %}selected{% endif %}>Mobile</option>
                            <option value="Tablet" {% if request.args.get('device_type') == 'Tablet' %}selected{% endif %}>Tablet</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="utm_source_filter" class="form-label">UTM Source</label>
                        <input type="text" class="form-control" id="utm_source_filter" name="utm_source" value="{{ request.args.get('utm_source', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="utm_medium_filter" class="form-label">UTM Medium</label>
                        <input type="text" class="form-control" id="utm_medium_filter" name="utm_medium" value="{{ request.args.get('utm_medium', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="utm_campaign_filter" class="form-label">UTM Campaign</label>
                        <input type="text" class="form-control" id="utm_campaign_filter" name="utm_campaign" value="{{ request.args.get('utm_campaign', '') }}">
                    </div>

                    <div class="col-md-3">
                        <label for="utm_content_filter" class="form-label">UTM Content</label>
                        <input type="text" class="form-control" id="utm_content_filter" name="utm_content" value="{{ request.args.get('utm_content', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="utm_term_filter" class="form-label">UTM Term</label>
                        <input type="text" class="form-control" id="utm_term_filter" name="utm_term" value="{{ request.args.get('utm_term', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="session_ip_filter" class="form-label">Session IP</label>
                        <input type="text" class="form-control" id="session_ip_filter" name="session_ip" value="{{ request.args.get('session_ip', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="actual_ip_filter" class="form-label">Actual IP</label>
                        <input type="text" class="form-control" id="actual_ip_filter" name="actual_ip" value="{{ request.args.get('actual_ip', '') }}">
                    </div>

                    <div class="col-md-3">
                        <label for="conversion_ip_filter" class="form-label">Conversion IP</label>
                        <input type="text" class="form-control" id="conversion_ip_filter" name="conversion_ip" value="{{ request.args.get('conversion_ip', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="geolocation_city_filter" class="form-label">Geolocation (City)</label>
                        <input type="text" class="form-control" id="geolocation_city_filter" name="geolocation_city" value="{{ request.args.get('geolocation_city', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="geolocation_country_filter" class="form-label">Geolocation (Country)</label>
                        <input type="text" class="form-control" id="geolocation_country_filter" name="geolocation_country" value="{{ request.args.get('geolocation_country', '') }}">
                    </div>
                    <div class="col-md-3">
                        <label for="clicks_suspicious_filter" class="form-label">Clicks (Suspicious)</label>
                        <input type="number" class="form-control" id="clicks_suspicious_filter" name="clicks_suspicious" value="{{ request.args.get('clicks_suspicious', '') }}" min="0">
                    </div>
                    <div class="col-md-3">
                        <label for="clicks_rejected_filter" class="form-label">Clicks (Rejected)</label>
                        <input type="number" class="form-control" id="clicks_rejected_filter" name="clicks_rejected" value="{{ request.args.get('clicks_rejected', '') }}" min="0">
                    </div>

                    <div class="col-12">
                        <button type="submit" class="btn btn-primary me-2"><i class="fas fa-search"></i> Apply Filters</button>
                        <a href="{{ url_for('admin_all_responses') }}" class="btn btn-outline-secondary"><i class="fas fa-times"></i> Clear Filters</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover table-sm">
            <thead>
                <tr>
                    <th>Response ID</th> {# This can serve as 'Complete ID' #}
                    <th>Survey Title</th>
                    <th>Submission Date</th>
                    <th>Respondent ID</th>
                    <th>Session ID</th>
                    <th>Form Status</th>
                    <th>UTM Source</th>
                    <th>UTM Medium</th>
                    <th>UTM Campaign</th>
                    <th>UTM Content</th>
                    <th>UTM Term</th>
                    <th>Session IP</th>
                    <th>Actual IP</th>
                    <th>Conversion IP</th>
                    <th>Geolocation (City)</th>
                    <th>Geolocation (Country)</th>
                    <th>Clicks (Suspicious)</th>
                    <th>Clicks (Rejected)</th>
                    <th>Browser</th>
                    <th>Device Type</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for response in all_responses %}
                <tr>
                    <td>{{ response.id }}</td>
                    <td><a href="{{ url_for('view_survey', survey_id=response.survey.id) }}">{{ response.survey.title }}</a></td>
                    <td>{{ response.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>{{ response.respondent_id if response.respondent_id else 'Guest' }}</td>
                    <td>{{ response.session_id if response.session_id else 'N/A' }}</td>
                    <td>{{ response.form_status if response.form_status else 'N/A' }}</td>
                    <td>{{ (response.utm_data or {}).get('utm_source', 'N/A') }}</td>
                    <td>{{ (response.utm_data or {}).get('utm_medium', 'N/A') }}</td>
                    <td>{{ (response.utm_data or {}).get('utm_campaign', 'N/A') }}</td>
                    <td>{{ (response.utm_data or {}).get('utm_content', 'N/A') }}</td>
                    <td>{{ (response.utm_data or {}).get('utm_term', 'N/A') }}</td>
                    <td>{{ (response.ip_data or {}).get('session_ip', 'N/A') }}</td>
                    <td>{{ (response.ip_data or {}).get('actual_ip', 'N/A') }}</td>
                    <td>{{ (response.ip_data or {}).get('conversion_ip', 'N/A') }}</td>
                    <td>{{ (response.geolocation_data or {}).get('city', 'N/A') }}</td>
                    <td>{{ (response.geolocation_data or {}).get('country', 'N/A') }}</td>
                    <td>{{ (response.click_data or {}).get('suspicious', 'N/A') }}</td>
                    <td>{{ (response.click_data or {}).get('rejected', 'N/A') }}</td>
                    <td>{{ response.browser if response.browser else 'N/A' }}</td>
                    <td>{{ response.device_type if response.device_type else 'N/A' }}</td>
                    <td>
                        <a href="{{ url_for('view_responses', survey_id=response.survey.id) }}#response-{{ response.id }}" class="btn btn-sm btn-info"><i class="fas fa-eye"></i> Details</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if not all_responses %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> No responses found yet.
        </div>
    {% endif %}
</div>
{% endblock %} 