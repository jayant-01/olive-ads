{% extends "base.html" %}

{% block title %}Postback Instructions{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0">Postback URL Instructions</h2>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        This guide explains how to set up and use postback URLs to track conversions and events in your applications.
                    </div>

                    <h3 class="mt-4">What is a Postback URL?</h3>
                    <p>
                        A postback URL is an endpoint that receives HTTP requests (GET or POST) when specific events occur in your application, 
                        such as when a user completes a survey or performs a conversion action.
                    </p>

                    <h3 class="mt-4">Your Postback Receiver URL</h3>
                    <div class="alert alert-light">
                        <code>{{ url_for('receive_postback', _external=True) }}</code>
                    </div>

                    <h3 class="mt-4">How to Use Postback URLs</h3>
                    
                    <h4>1. Basic GET Request</h4>
                    <p>Send data as URL parameters:</p>
                    <pre><code>{{ url_for('receive_postback', _external=True) }}?event=conversion&user_id=123&amount=9.99&status=completed</code></pre>

                    <h4 class="mt-3">2. POST Request with Form Data</h4>
                    <p>Send data as form-urlencoded:</p>
                    <pre><code>POST {{ url_for('receive_postback', _external=True) }}
Content-Type: application/x-www-form-urlencoded

event=conversion&user_id=123&amount=9.99&status=completed</code></pre>

                    <h4 class="mt-3">3. POST Request with JSON Data</h4>
                    <p>Send complex data as JSON:</p>
                    <pre><code>POST {{ url_for('receive_postback', _external=True) }}
Content-Type: application/json

{
    "event": "survey_completed",
    "user_id": "123",
    "survey_id": "srv_456",
    "answers": [
        {"question_id": 1, "answer": "Yes"},
        {"question_id": 2, "answer": 5}
    ],
    "metadata": {
        "ip_address": "192.168.1.1",
        "user_agent": "Mozilla/5.0..."
    }
}</code></pre>

                    <h3 class="mt-4">Available Parameters</h3>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>event</code></td>
                                    <td>String</td>
                                    <td>Yes</td>
                                    <td>Type of event (e.g., conversion, signup, purchase)</td>
                                </tr>
                                <tr>
                                    <td><code>user_id</code></td>
                                    <td>String/Number</td>
                                    <td>Yes</td>
                                    <td>Unique identifier for the user</td>
                                </tr>
                                <tr>
                                    <td><code>amount</code></td>
                                    <td>Number</td>
                                    <td>No</td>
                                    <td>Transaction amount (for purchases/conversions)</td>
                                </tr>
                                <tr>
                                    <td><code>status</code></td>
                                    <td>String</td>
                                    <td>No</td>
                                    <td>Status of the event (e.g., completed, failed, pending)</td>
                                </tr>
                                <tr>
                                    <td><code>reference_id</code></td>
                                    <td>String</td>
                                    <td>No</td>
                                    <td>Your reference ID for this transaction/event</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3 class="mt-4">Testing Your Postback URL</h3>
                    <p>You can test your postback URL using cURL:</p>
                    <pre><code># Test GET request
curl "{{ url_for('receive_postback', _external=True) }}?event=test&user_id=test123&status=success"

# Test POST request with form data
curl -X POST "{{ url_for('receive_postback', _external=True) }}" \
     -d "event=test" \
     -d "user_id=test123" \
     -d "status=success"

# Test POST request with JSON data
curl -X POST "{{ url_for('receive_postback', _external=True) }}" \
     -H "Content-Type: application/json" \
     -d '{"event":"test","user_id":"test123","status":"success"}'</code></pre>

                    <h3 class="mt-4">Viewing Received Postbacks</h3>
                    <p>All received postbacks can be viewed in the <a href="{{ url_for('postback_receiver_dashboard') }}">Postback Dashboard</a>.</p>
                    <p>Each postback entry includes:</p>
                    <ul>
                        <li>Request method (GET/POST)</li>
                        <li>Timestamp</li>
                        <li>Status (received/processed/error)</li>
                        <li>Source IP</li>
                        <li>Detailed request data</li>
                    </ul>

                    <div class="alert alert-warning mt-4">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <strong>Important:</strong> For production use, consider implementing IP whitelisting and request signing for security.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
